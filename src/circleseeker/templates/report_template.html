<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eccDNA Analysis Report - {sample_name}</title>
    <link rel="stylesheet" href="{css_path}">
</head>
<body>
    <header>
        <h1>eccDNA Analysis Report<br>{sample_name}</h1>
        <div class="report-info">
            <p><strong>Generated:</strong> {generation_date}</p>
            <p><strong>CircleSeeker Version:</strong> {version}</p>
        </div>
    </header>

    <main>
        <!-- Executive Summary -->
        <section class="analysis-section">
            <h2>Executive Summary</h2>
            <div class="summary-box important">
                <p>This report presents a comprehensive analysis of extrachromosomal circular DNA (eccDNA)
                identified in sample <strong>{sample_name}</strong>. The analysis processed <strong>{total_reads:,}</strong> total reads,
                identifying <strong>{total_ctcr:,}</strong> CtcReads representing
                <strong>{ctcr_percentage:.2f}%</strong> of all sequenced reads.</p>
                <p style="margin-top: 8px; font-size: 12px; color: #6c757d;">Ctc = Concatemeric tandem copies.</p>
            </div>
        </section>

        <!-- Read Classification Statistics -->
        <section class="analysis-section">
            <h2>1. Read Classification Statistics</h2>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="label">Total Reads</div>
                    <div class="value number">{total_reads:,}</div>
                </div>
                <div class="stat-item">
                    <div class="label">CtcReads</div>
                    <div class="value number">{total_ctcr:,}</div>
                    <div class="percentage">({ctcr_percentage:.2f}% of total)</div>
                </div>
                <div class="stat-item">
                    <div class="label">Other Reads</div>
                    <div class="value number">{other_reads:,}</div>
                    <div class="percentage">({other_percentage:.2f}% of total)</div>
                </div>
            </div>
        </section>

        <!-- CtcReads Subtype Distribution -->
        <section class="analysis-section">
            <h2>2. CtcReads Subtype Distribution</h2>

            <table>
                <caption>Table 1: Distribution of CtcReads subtypes</caption>
                <thead>
                    <tr>
                        <th>CtcReads Subtype</th>
                        <th>Count</th>
                        <th>Percentage of CtcReads</th>
                        <th>Percentage of Total Reads</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>CtcR-perfect</strong></td>
                        <td class="number">{ctcr_perfect:,}</td>
                        <td class="number">{ctcr_perfect_pct:.2f}%</td>
                        <td class="number">{ctcr_perfect_total_pct:.2f}%</td>
                        <td>Perfect circular template matches</td>
                    </tr>
                    <tr>
                        <td><strong>CtcR-hybrid</strong></td>
                        <td class="number">{ctcr_hybrid:,}</td>
                        <td class="number">{ctcr_hybrid_pct:.2f}%</td>
                        <td class="number">{ctcr_hybrid_total_pct:.2f}%</td>
                        <td>Hybrid circular template matches</td>
                    </tr>
                    <tr>
                        <td><strong>CtcR-inversion</strong></td>
                        <td class="number">{ctcr_inversion:,}</td>
                        <td class="number">{ctcr_inversion_pct:.2f}%</td>
                        <td class="number">{ctcr_inversion_total_pct:.2f}%</td>
                        <td>Inverted circular template matches</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- eccDNA Sequence Statistics -->
        <section class="analysis-section">
            <h2>3. eccDNA Sequence Statistics</h2>

            <table>
                <caption>Table 2: Statistical summary of identified eccDNA sequences by type</caption>
                <thead>
                    <tr>
                        <th>eccDNA Type</th>
                        <th>Count</th>
                        <th>Min Length (bp)</th>
                        <th>Max Length (bp)</th>
                        <th>Mean Length (bp)</th>
                        <th>Median Length (bp)</th>
                        <th>Mode Length (bp)</th>
                        <th>Std Dev (bp)</th>
                    </tr>
                </thead>
                <tbody>
                    {eccdna_stats_rows}
                </tbody>
            </table>

            <div class="summary-box note">
                <p><strong>Note:</strong> The "All eccDNA (Combined)" row represents aggregate statistics
                of all eccDNA sequences from UeccDNA, MeccDNA, CeccDNA, and Inferred eccDNA combined.
                This provides an overall view of the eccDNA size distribution in the sample.</p>
            </div>
        </section>

        <!-- Overlap Analysis -->
        <section class="analysis-section">
            <h2>4. Overlap Analysis Between Inferred and Confirmed eccDNA</h2>

            <div class="overlap-analysis">
                <div class="summary-box">
                    <p><strong>Total Inferred eccDNA sequences:</strong> <span class="number">{total_inferred:,}</span></p>
                </div>

                <div class="overlap-grid">
                    <div class="overlap-item">
                        <div class="type">UeccDNA Overlaps</div>
                        <div class="count number">{uecc_overlaps:,}</div>
                        <div class="percent">{uecc_overlap_pct:.2f}% of inferred</div>
                    </div>
                    <div class="overlap-item">
                        <div class="type">MeccDNA Overlaps</div>
                        <div class="count number">{mecc_overlaps:,}</div>
                        <div class="percent">{mecc_overlap_pct:.2f}% of inferred</div>
                    </div>
                    <div class="overlap-item">
                        <div class="type">CeccDNA Overlaps</div>
                        <div class="count number">{cecc_overlaps:,}</div>
                        <div class="percent">{cecc_overlap_pct:.2f}% of inferred</div>
                    </div>
                </div>

                <div class="summary-box">
                    <p><strong>Summary:</strong> Among <span class="number">{total_inferred:,}</span> inferred eccDNA sequences,
                    <span class="number">{uecc_overlaps:,}</span> share identical sequences with UeccDNA ({uecc_overlap_pct:.2f}%),
                    <span class="number">{mecc_overlaps:,}</span> share identical sequences with MeccDNA ({mecc_overlap_pct:.2f}%),
                    and <span class="number">{cecc_overlaps:,}</span> share identical sequences with CeccDNA ({cecc_overlap_pct:.2f}%).</p>

                    <p><strong>Methodology:</strong> Overlaps are determined by comparing actual sequence content,
                    not sequence identifiers. This analysis helps validate the accuracy of computational predictions
                    against experimentally confirmed eccDNA sequences.</p>
                </div>
            </div>
        </section>

        <!-- Methods and Data Quality -->
        <section class="analysis-section">
            <h2>5. Methods and Data Quality</h2>

            <h3>5.1 Data Processing Pipeline</h3>
            <p>eccDNA sequences were identified and classified using the CircleSeeker computational pipeline.
            The analysis workflow included read filtering, circular template detection, sequence assembly,
            and comparative analysis against reference databases.</p>

            <h3>5.2 Quality Metrics</h3>
            <div class="stats-container">
                <p><strong>Read Coverage:</strong> {ctcr_percentage:.2f}% of reads contained circular templates</p>
                <p><strong>Classification Accuracy:</strong> Based on sequence identity comparison with confirmed eccDNA</p>
                <p><strong>Statistical Significance:</strong> All reported statistics based on complete dataset analysis</p>
            </div>

            <h3>5.3 Limitations</h3>
            <div class="summary-box note">
                <p>This analysis is based on computational predictions and may include false positives.
                Experimental validation is recommended for critical findings. The overlap analysis
                provides an estimate of prediction accuracy based on available confirmed sequences.</p>
            </div>
        </section>
    </main>

    <footer class="report-footer">
        <p>Report generated by CircleSeeker v{version} | {generation_date}</p>
        <p>For questions regarding this analysis, please refer to the CircleSeeker documentation</p>
    </footer>
</body>
</html>
